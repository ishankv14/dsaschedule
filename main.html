<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>DSA Study Schedule Infographic</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700;900&display=swap" rel="stylesheet">
    <!-- Firebase SDK imports -->
    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-app.js";
        import { getAuth, signInAnonymously, signInWithCustomToken, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-auth.js";
        import { getFirestore } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-firestore.js"; // Only getFirestore here

        // Global Firebase variables
        window.firebaseApp = null;
        window.db = null;
        window.auth = null;
        window.userId = null;
        window.isAuthReady = false;

        window.initializeFirebase = async () => {
            const loadingOverlay = document.getElementById('loading-overlay');
            try {
                // --- START: Replace with your actual Firebase project configuration ---
                // Get your Firebase config from your Firebase project settings in the Firebase console.
                // It should look something like this:
                const firebaseConfig = {
                    apiKey: "YOUR_API_KEY", // <--- REPLACE THIS WITH YOUR ACTUAL API KEY
                    authDomain: "YOUR_PROJECT_ID.firebaseapp.com", // <--- REPLACE THIS
                    projectId: "YOUR_PROJECT_ID", // <--- REPLACE THIS
                    storageBucket: "YOUR_PROJECT_ID.appspot.com", // <--- REPLACE THIS
                    messagingSenderId: "YOUR_MESSAGING_SENDER_ID", // <--- REPLACE THIS
                    appId: "YOUR_APP_ID" // <--- REPLACE THIS
                };

                // Use a unique string for your appId when deploying outside Canvas environment
                const appId = "dsa-schedule-infographic-github"; // <--- You can use any unique string here
                // --- END: Replace with your actual Firebase project configuration ---

                // Check if projectId or apiKey is still the placeholder
                if (!firebaseConfig.projectId || firebaseConfig.projectId === "YOUR_PROJECT_ID" || firebaseConfig.apiKey === "YOUR_API_KEY") {
                    const errorMessage = "Firebase configuration is incomplete or uses placeholder values. Please replace 'YOUR_API_KEY', 'YOUR_PROJECT_ID', 'YOUR_MESSAGING_SENDER_ID', and 'YOUR_APP_ID' with your actual Firebase project details from the Firebase console.";
                    throw new Error(errorMessage);
                }

                if (!window.firebaseApp) {
                    window.firebaseApp = initializeApp(firebaseConfig);
                    window.db = getFirestore(window.firebaseApp);
                    window.auth = getAuth(window.firebaseApp);
                }

                onAuthStateChanged(window.auth, async (user) => {
                    if (user) {
                        window.userId = user.uid;
                        console.log("Authenticated with UID:", window.userId);
                    } else {
                        // When deployed on GitHub, __initial_auth_token will not be defined.
                        // We default to anonymous sign-in in this case.
                        if (typeof __initial_auth_token !== 'undefined' && __initial_auth_token) {
                            await signInWithCustomToken(window.auth, __initial_auth_token);
                            window.userId = window.auth.currentUser.uid;
                            console.log("Signed in with custom token. UID:", window.userId);
                        } else {
                            await signInAnonymously(window.auth);
                            window.userId = window.auth.currentUser.uid;
                            console.log("Signed in anonymously. UID:", window.userId);
                        }
                    }
                    window.isAuthReady = true;
                    // Trigger calendar render after auth is ready and user ID is set
                    window.dispatchEvent(new CustomEvent('authReady'));
                    loadingOverlay.style.display = 'none'; // Hide loading overlay on successful auth
                });

            } catch (error) {
                console.error("Error initializing Firebase:", error);
                loadingOverlay.style.display = 'none'; // Ensure loading overlay is hidden on error
                // Display an error message to the user on the UI
                const errorMessageDiv = document.createElement('div');
                errorMessageDiv.textContent = `Error: ${error.message}`;
                errorMessageDiv.style.color = 'red';
                errorMessageDiv.style.marginTop = '20px';
                errorMessageDiv.style.textAlign = 'center';
                errorMessageDiv.style.padding = '10px';
                errorMessageDiv.style.backgroundColor = '#3a3a3a';
                errorMessageDiv.style.borderRadius = '8px';
                errorMessageDiv.style.border = '1px solid red';
                errorMessageDiv.style.maxWidth = '600px';
                errorMessageDiv.style.margin = '20px auto';
                document.body.prepend(errorMessageDiv); // Add to the top of the body
            }
        };

        window.initializeFirebase();
    </script>
    <style>
        body {
            font-family: 'Inter', sans-serif;
            background-color: #121212; /* Even darker background for the page */
            color: #e0e0e0; /* Lighter text for contrast */
        }
        .chart-container {
            position: relative;
            width: 100%;
            max-width: 500px;
            margin-left: auto;
            margin-right: auto;
            height: 300px;
            max-height: 400px;
        }
        @media (min-width: 768px) {
            .chart-container {
                height: 350px;
            }
        }
        .gradient-text {
            background: linear-gradient(90deg, #00A6FB, #00D2B8);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }
        .kpi-card {
            background-color: #1f1f1f; /* Darker card background */
            border-left: 4px solid #F5B700;
            color: #e0e0e0;
        }
        .flow-arrow {
            font-size: 2rem;
            color: #F5B700;
            line-height: 1;
        }
        .timeline-item::before {
            content: '';
            position: absolute;
            left: 19px;
            top: 0;
            bottom: 0;
            width: 2px;
            background-color: #3a3a3a; /* Darker timeline line */
        }
        .timeline-item:last-child::before {
            display: none;
        }
        .timeline-dot {
            position: absolute;
            left: 0;
            top: 0;
            transform: translateX(-50%);
            width: 40px;
            height: 40px;
            border-radius: 50%;
            background-color: #F5B700;
            color: #121212; /* Darker text for dot */
            border: 4px solid #1f1f1f; /* Darker border for dot */
        }
        .task-item.completed .task-text {
            text-decoration: line-through;
            color: #616161; /* Darker grey for completed tasks */
        }
        .calendar-grid {
            display: grid;
            grid-template-columns: repeat(7, minmax(0, 1fr));
            gap: 10px; /* Increased gap for more breathing room */
        }
        .calendar-day-header {
            background-color: #1f1f1f; /* Darker header background */
            color: #00A6FB;
            font-weight: bold;
            padding: 12px; /* More padding */
            text-align: center;
            border-radius: 10px; /* More rounded corners */
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.3); /* Stronger shadow */
        }
        .calendar-day-cell {
            background-color: #1f1f1f; /* Darker cell background */
            border-radius: 15px; /* Even more rounded corners */
            padding: 18px; /* Increased padding */
            min-height: 220px; /* Adjusted min-height */
            display: flex;
            flex-direction: column;
            justify-content: flex-start;
            align-items: flex-start;
            box-shadow: 0 8px 16px rgba(0, 0, 0, 0.4); /* Stronger shadow */
            transition: transform 0.2s ease-in-out, box-shadow 0.2s ease-in-out;
        }
        .calendar-day-cell:hover {
            transform: translateY(-8px); /* Lift more on hover */
            box-shadow: 0 12px 24px rgba(0, 0, 0, 0.6); /* More pronounced shadow on hover */
        }
        .calendar-day-cell.empty {
            background-color: #121212; /* Match body background for empty cells */
            box-shadow: none;
            border: 1px dashed #3a3a3a; /* Darker dashed border */
        }
        .calendar-date {
            font-weight: bold;
            font-size: 1.3rem; /* Larger date font */
            color: #F5B700;
            margin-bottom: 15px; /* More space below date */
            align-self: flex-end;
            background-color: #2a2a2a; /* Subtle background for date */
            padding: 4px 8px;
            border-radius: 8px;
        }
        .task-item {
            display: flex;
            align-items: flex-start;
            margin-bottom: 10px; /* More space between tasks */
            font-size: 1.05rem; /* Slightly larger task font */
            padding: 8px 12px; /* More padding for tasks */
            border-radius: 8px; /* More rounded task items */
            width: 100%;
            border: 1px solid transparent;
            background-color: #2a2a2a; /* Default task background */
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.2);
            cursor: grab; /* Indicate draggable */
        }
        .task-item.task-easy {
            background-color: rgba(0, 210, 184, 0.1); /* Lighter opacity for easier readability on dark bg */
            border-color: #00D2B8;
            color: #00D2B8;
        }
        .task-item.task-medium {
            background-color: rgba(245, 183, 0, 0.1);
            border-color: #F5B700;
            color: #F5B700;
        }
        .task-item.task-hard {
            background-color: rgba(220, 0, 115, 0.1);
            border-color: #DC0073;
            color: #DC0073;
        }
        .task-item input[type="checkbox"] {
            margin-top: 5px; /* Adjust alignment */
            flex-shrink: 0;
            accent-color: #00A6FB;
            transform: scale(1.1); /* Slightly larger checkbox */
        }
        .task-text {
            margin-left: 12px; /* More space from checkbox */
            flex-grow: 1; /* Allow text to grow and take available space */
            min-width: 0; /* Allow text to shrink below its content size if necessary */
            line-height: 1.5; /* Better line spacing */
            word-wrap: break-word; /* Ensure long words break */
            overflow-wrap: break-word; /* Fallback for word-wrap */
            max-width: 100%; /* Ensure it respects its container's width */
        }
        .notes-text {
            font-size: 0.9rem; /* Slightly larger notes font */
            color: #a0a0a0; /* Slightly darker grey for notes */
            margin-top: auto;
            padding-top: 12px; /* More padding */
            border-top: 1px solid #3a3a3a; /* Darker border */
            width: 100%;
            line-height: 1.4;
        }
        .rest-day {
            background-color: #1f1f1f;
            border: 1px solid #00A6FB; /* Highlight rest days with blue border */
            color: #00A6FB;
            text-align: center;
            font-weight: bold;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        /* Drag and Drop styles */
        .calendar-day-cell.drag-over {
            border: 2px dashed #00A6FB;
            background-color: #2a2a2a;
            box-shadow: 0 0 15px rgba(0, 166, 251, 0.5);
        }

        /* Responsive adjustments for smaller screens */
        @media (max-width: 768px) {
            .calendar-grid {
                gap: 5px; /* Smaller gap on mobile */
            }
            .calendar-day-cell {
                padding: 10px; /* Smaller padding on mobile */
                min-height: 150px; /* Smaller min-height on mobile */
            }
            .calendar-date {
                font-size: 1rem; /* Smaller date font on mobile */
                margin-bottom: 8px;
            }
            .task-item {
                font-size: 0.85rem; /* Smaller task font on mobile */
                padding: 6px 8px; /* Smaller padding for tasks on mobile */
                margin-bottom: 6px;
            }
            .task-item input[type="checkbox"] {
                transform: scale(0.9); /* Slightly smaller checkbox on mobile */
            }
            .task-text {
                margin-left: 8px; /* Smaller margin for text on mobile */
            }
            .notes-text {
                font-size: 0.8rem; /* Smaller notes font on mobile */
                padding-top: 8px;
            }
            .calendar-navigation button {
                padding: 8px 12px;
                font-size: 0.9rem;
            }
            .calendar-month-year {
                font-size: 1.8rem;
            }
        }
        @media (max-width: 480px) {
            .calendar-day-cell {
                min-height: 120px; /* Even smaller min-height on very small mobile */
                padding: 8px;
            }
            .task-item {
                font-size: 0.75rem; /* Even smaller task font on very small mobile */
                padding: 4px 6px;
                margin-bottom: 4px;
            }
            .task-text {
                margin-left: 6px;
            }
        }
        #loading-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.7);
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 1000;
            color: white;
            font-size: 1.5rem;
            flex-direction: column;
        }
        .spinner {
            border: 4px solid rgba(255, 255, 255, 0.3);
            border-top: 4px solid #00A6FB;
            border-radius: 50%;
            width: 40px;
            height: 40px;
            animation: spin 1s linear infinite;
            margin-bottom: 10px;
        }
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
    </style>
</head>
<body class="antialiased">

    <div id="loading-overlay">
        <div class="spinner"></div>
        Loading your schedule...
    </div>

    <div class="container mx-auto p-4 md:p-8">

        <header class="text-center my-12">
            <h1 class="text-4xl md:text-6xl font-black tracking-tight leading-tight">Master DSA Without the Burnout</h1>
            <p class="mt-4 text-xl md:text-2xl font-light text-slate-400">A Strategic, <span class="gradient-text font-semibold">Difficulty-Balanced</span> Approach with takeUforward</p>
        </header>

        <main>
            <section id="ecosystem" class="mb-20">
                <div class="text-center mb-12">
                    <h2 class="text-3xl md:text-4xl font-bold">Your Complete DSA Learning Ecosystem</h2>
                    <p class="mt-2 text-lg text-slate-400 max-w-3xl mx-auto">takeUforward provides the structured content and support needed to turn a daunting challenge into a manageable journey.</p>
                </div>

                <div class="grid grid-cols-1 md:grid-cols-3 gap-8 mb-12 text-center">
                    <div class="kpi-card p-6 rounded-lg shadow-xl">
                        <p class="text-5xl font-extrabold text-white">1000+</p>
                        <p class="mt-2 text-lg font-semibold text-slate-300">Practice Problems</p>
                    </div>
                    <div class="kpi-card p-6 rounded-lg shadow-xl">
                        <p class="text-5xl font-extrabold text-white">473+</p>
                        <p class="mt-2 text-lg font-semibold text-slate-300">Core DSA Course Problems</p>
                    </div>
                    <div class="kpi-card p-6 rounded-lg shadow-xl">
                        <p class="text-5xl font-extrabold text-white">16+</p>
                        <p class="mt-2 text-lg font-semibold text-slate-300">Contests to Test Your Skills</p>
                    </div>
                </div>

                <div class="grid grid-cols-1 lg:grid-cols-2 gap-8 items-center">
                    <div class="bg-slate-800 p-6 rounded-lg shadow-xl">
                        <h3 class="text-2xl font-bold text-center mb-4">A2Z Course Problem Distribution</h3>
                        <p class="text-center text-slate-400 mb-4">The explicit difficulty labels are the key to building a balanced schedule. The A2Z course provides a rich mix of problems at every level.</p>
                        <div class="chart-container">
                            <canvas id="a2zDonutChart"></canvas>
                        </div>
                    </div>

                    <div class="bg-slate-800 p-6 rounded-lg shadow-xl">
                        <h3 class="text-2xl font-bold text-center mb-4">DP Series Problem Distribution</h3>
                        <p class="text-center text-slate-400 mb-4">Even specialized, advanced topics like Dynamic Programming are categorized, allowing for targeted, high-difficulty practice sessions.</p>
                        <div class="chart-container">
                            <canvas id="dpBarChart"></canvas>
                        </div>
                    </div>
                </div>
            </section>

            <section id="logic" class="mb-20">
                <div class="text-center mb-12">
                    <h2 class="text-3xl md:text-4xl font-bold">The Core Scheduling Patterns</h2>
                    <p class="mt-2 text-lg text-slate-400 max-w-3xl mx-auto">Mix and match these patterns based on your daily energy and goals to ensure consistent, sustainable progress.</p>
                </div>

                <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6 text-center">
                    <div class="bg-slate-800 p-6 rounded-lg shadow-lg border-t-4 border-blue-500">
                        <p class="text-2xl font-bold">1 Easy + 1 Hard</p>
                        <p class="mt-2 text-slate-300">Builds confidence, then pushes your limits. Perfect for balanced challenge.</p>
                    </div>
                    <div class="bg-slate-800 p-6 rounded-lg shadow-lg border-t-4 border-teal-400">
                        <p class="text-2xl font-bold">1 Easy + 1 Medium</p>
                        <p class="mt-2 text-slate-300">Ensures steady, incremental progress without overwhelming you.</p>
                    </div>
                    <div class="bg-slate-800 p-6 rounded-lg shadow-lg border-t-4 border-yellow-500">
                        <p class="text-2xl font-bold">1 Medium + 1 Hard</p>
                        <p class="mt-2 text-slate-300">Ideal for high-energy days when you're ready to tackle significant challenges.</p>
                    </div>
                    <div class="bg-slate-800 p-6 rounded-lg shadow-lg border-t-4 border-pink-600">
                        <p class="text-2xl font-bold">Only 1 Hard</p>
                        <p class="mt-2 text-slate-300">A crucial rule for when a problem is too difficult. Focus on deep understanding.</p>
                    </div>
                </div>
            </section>

            <section id="action-plan" class="mb-20">
                <div class="text-center mb-12">
                    <h2 class="text-3xl md:text-4xl font-bold">Your 4-Step Action Plan</h2>
                    <p class="mt-2 text-lg text-slate-400 max-w-3xl mx-auto">Follow this process to create and maintain your personalized DSA study schedule.</p>
                </div>

                <div class="max-w-4xl mx-auto">
                    <div class="relative pl-12 py-4 timeline-item">
                        <div class="timeline-dot flex items-center justify-center text-2xl font-bold">1</div>
                        <h3 class="text-2xl font-bold text-white mb-2">Inventory Your Topics</h3>
                        <p class="text-slate-300">List all DSA topics you need to learn or revise. Use takeUforward's course syllabi as a comprehensive guide to ensure nothing is missed.</p>
                    </div>
                    <div class="relative pl-12 py-4 timeline-item">
                        <div class="timeline-dot flex items-center justify-center text-2xl font-bold">2</div>
                        <h3 class="text-2xl font-bold text-white mb-2">Categorize by Difficulty</h3>
                        <p class="text-slate-300">Assign an 'Easy', 'Medium', or 'Hard' label to each topic or problem based on takeUforward's classification. This forms the backbone of your strategy.</p>
                    </div>
                    <div class="relative pl-12 py-4 timeline-item">
                        <div class="timeline-dot flex items-center justify-center text-2xl font-bold">3</div>
                        <h3 class="text-2xl font-bold text-white mb-2">Implement the Schedule</h3>
                        <p class="text-300">Apply the difficulty-balanced patterns to your topic list. Refer to the sample weekly schedule below for inspiration.</p>
                    </div>
                    <div class="relative pl-12 py-4 timeline-item">
                        <div class="timeline-dot flex items-center justify-center text-2xl font-bold">4</div>
                        <h3 class="text-2xl font-bold text-white mb-2">Integrate Revision & Practice</h3>
                        <p class="text-slate-300">Your schedule isn't just for new topics. Regularly revisit old problems and participate in contests to solidify your knowledge for the long term.</p>
                    </div>
                </div>
            </section>

            <section id="sample-schedule" class="mb-20">
                <div class="text-center mb-12">
                    <h2 class="text-3xl md:text-4xl font-bold">Comprehensive DSA Study Calendar</h2>
                    <p class="mt-2 text-lg text-slate-400 max-w-3xl mx-auto">A detailed calendar applying the difficulty-balanced approach. Mark tasks complete as you go!</p>
                </div>

                <div class="bg-slate-900 p-6 rounded-lg shadow-xl border border-gray-700"> <!-- Darker background for calendar section -->
                    <!-- Calendar Navigation -->
                    <div class="flex justify-between items-center mb-6 calendar-navigation">
                        <button id="prevBtn" class="bg-blue-600 hover:bg-blue-700 text-white font-bold py-2 px-4 rounded-lg transition duration-300 ease-in-out shadow-md">
                            &lt; Previous
                        </button>
                        <h3 id="currentPeriodDisplay" class="text-3xl font-bold text-white calendar-month-year"></h3>
                        <button id="nextBtn" class="bg-blue-600 hover:bg-blue-700 text-white font-bold py-2 px-4 rounded-lg transition duration-300 ease-in-out shadow-md">
                            Next &gt;
                        </button>
                        <button id="monthViewBtn" class="bg-blue-600 hover:bg-blue-700 text-white font-bold py-2 px-4 rounded-lg transition duration-300 ease-in-out shadow-md ml-2">
                            Month View
                        </button>
                        <button id="weekViewBtn" class="bg-blue-600 hover:bg-blue-700 text-white font-bold py-2 px-4 rounded-lg transition duration-300 ease-in-out shadow-md ml-2">
                            Week View
                        </button>
                    </div>

                    <!-- Calendar Headers -->
                    <div class="calendar-grid mb-4">
                        <div class="calendar-day-header">Mon</div>
                        <div class="calendar-day-header">Tue</div>
                        <div class="calendar-day-header">Wed</div>
                        <div class="calendar-day-header">Thu</div>
                        <div class="calendar-day-header">Fri</div>
                        <div class="calendar-day-header">Sat</div>
                        <div class="calendar-day-header">Sun</div>
                    </div>

                    <!-- Calendar Grid -->
                    <div id="calendarGrid" class="calendar-grid">
                        <!-- Calendar cells will be dynamically generated here -->
                    </div>
                </div>
            </section>

             <section id="roadblocks" class="mb-20">
                <div class="text-center mb-12">
                    <h2 class="text-3xl md:text-4xl font-bold">What to Do When a Problem is "Too Hard"</h2>
                    <p class="mt-2 text-lg text-slate-400 max-w-3xl mx-auto">Getting stuck is part of learning. Here’s a strategic flowchart to turn roadblocks into breakthroughs.</p>
                </div>
                <div class="flex flex-col items-center justify-center space-y-4">
                    <div class="bg-pink-600/20 border border-pink-600 text-white p-4 rounded-lg shadow-lg w-full max-w-md text-center">
                        <h4 class="font-bold text-xl">You're Stuck on a Hard Problem</h4>
                        <p>After 30-60 minutes of focused effort with no progress.</p>
                    </div>
                    <div class="flow-arrow">↓</div>
                    <div class="bg-blue-500/20 border border-blue-500 text-white p-4 rounded-lg shadow-lg w-full max-w-md text-center">
                        <h4 class="font-bold text-xl">1. Revisit Fundamentals</h4>
                        <p>Are you missing a prerequisite concept? Review easier problems in the same topic.</p>
                    </div>
                    <div class="flow-arrow">↓</div>
                     <div class="bg-teal-400/20 border border-teal-400 text-white p-4 rounded-lg shadow-lg w-full max-w-md text-center">
                        <h4 class="font-bold text-xl">2. Seek Targeted Help</h4>
                        <p>Use takeUforward's AI Doubt Support or consult video/written editorials to understand the approach.</p>
                    </div>
                     <div class="flow-arrow">↓</div>
                     <div class="bg-yellow-500/20 border border-yellow-500 text-white p-4 rounded-lg shadow-lg w-full max-w-md text-center">
                        <h4 class="font-bold text-xl">3. Deeply Understand the Solution</h4>
                        <p>Don't just copy the code. Comprehend the logic, then try to re-implement it yourself from scratch.</p>
                    </div>
                </div>
            </section>


            <footer class="text-center mt-20 py-8 border-t border-gray-700"> <!-- Darker footer border -->
                <p class="text-2xl font-bold gradient-text">Your Path to Proficiency Starts Now</p>
                <p class="text-slate-400 mt-2 max-w-2xl mx-auto">Consistency, strategic practice, and leveraging the right resources are your keys to success. Keep coding!</p>
            </footer>

        </main>
    </div>

    <script type="module">
        import { collection, query, onSnapshot, setDoc, doc, updateDoc, deleteDoc, getDocs, getDoc, writeBatch } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-firestore.js";

        // Global variables for calendar state
        let currentMonth = 6; // 0-indexed (July is 6)
        let currentYear = 2025;
        let currentView = 'month'; // 'month' or 'week'
        let currentWeekStartDate = new Date(); // Will be set to the Monday of the current week

        // Data structure to hold tasks, populated from Firestore
        let tasks = {}; // Key:YYYY-MM-DD, Value: Array of task objects

        const monthNames = ["January", "February", "March", "April", "May", "June", "July", "August", "September", "October", "November", "December"];

        let draggedTask = null;
        let draggedFromDate = null;

        // Initial static tasks to populate Firestore if empty
        const initialStaticTasks = {
            "2025-07-04": [
                { id: "task-2025-07-04-0", text: "Easy: Sum of first N numbers (A2Z)", difficulty: "easy", completed: false },
                { id: "task-2025-07-04-1", text: "Medium: Hashing Theory (A2Z)", difficulty: "medium", completed: false }
            ],
            "2025-07-05": [
                { id: "task-2025-07-05-0", text: "Easy: Check Palindrome (A2Z)", difficulty: "easy", completed: false },
                { id: "task:2025-07-05-1", text: "Hard: Coin Change 2 (DP)", difficulty: "hard", completed: false }
            ],
            "2025-07-14": [
                { id: "task-2025-07-14-0", text: "Easy: GCD or HCF (A2Z)", difficulty: "easy", completed: false },
                { id: "task-2025-07-14-1", text: "Hard: Subset Sum Equal to Target (DP)", difficulty: "hard", completed: false }
            ],
            "2025-07-15": [
                { id: "task-2025-07-15-0", text: "Easy: Print all Divisors (A2Z)", difficulty: "easy", completed: false },
                { id: "task-2025-07-15-1", text: "Medium: Selection Sort (A2Z)", difficulty: "medium", completed: false }
            ],
            "2025-07-16": [
                { id: "task-2025-07-16-0", text: "Medium: Counting Frequencies (A2Z)", difficulty: "medium", completed: false },
                { id: "task-2025-07-16-1", text: "Hard: Partition Equal Subset Sum (DP)", difficulty: "hard", completed: false }
            ],
            "2025-07-17": [
                { id: "task-2025-07-17-0", text: "Only 1 Hard: Target Sum (DP)", difficulty: "hard", completed: false }
            ],
            "2025-07-18": [
                { id: "task-2025-07-18-0", text: "Easy: Check for Prime (A2Z)", difficulty: "easy", completed: false },
                { id: "task-2025-07-18-1", text: "Medium: Bubble Sort (A2Z)", difficulty: "medium", completed: false }
            ],
            "2025-07-19": [
                { id: "task-2025-07-19-0", text: "Easy: Fibonacci Number (A2Z)", difficulty: "easy", completed: false },
                { id: "task-2025-07-19-1", text: "Hard: Count Subsets with Sum K (DP)", difficulty: "hard", completed: false }
            ],
            "2025-07-20": [
                { id: "task-2025-07-20-0", text: "Contest/Mock Interview / Rest", difficulty: "rest", completed: false }
            ],
            "2025-07-21": [
                { id: "task-2025-07-21-0", text: "Easy: Check Armstrong Number (A2Z)", difficulty: "easy", completed: false },
                { id: "task-2025-07-21-1", text: "Medium: Insertion Sort (A2Z)", difficulty: "medium", completed: false }
            ],
            "2025-07-22": [
                { id: "task-2025-07-22-0", text: "Medium: Quick Sort (A2Z)", difficulty: "medium", completed: false },
                { id: "task-2025-07-22-1", text: "Hard: Longest Palindromic Subsequence (DP)", difficulty: "hard", completed: false }
            ],
            "2025-07-23": [
                { id: "task-2025-07-23-0", text: "Easy: Print N to 1 (Recursion)", difficulty: "easy", completed: false },
                { id: "task-2025-07-23-1", text: "Medium: Check if Sorted Array (A2Z)", difficulty: "medium", completed: false }
            ],
            "2025-07-24": [
                { id: "task-2025-07-24-0", text: "Hard: Minimum Path Sum (DP)", difficulty: "hard", completed: false }
            ],
            "2025-07-25": [
                { id: "task-2025-07-25-0", text: "Easy: Reverse an Array (A2Z)", difficulty: "easy", completed: false },
                { id: "task-2025-07-25-1", text: "Medium: Remove Duplicates from Sorted Array (A2Z)", difficulty: "medium", completed: false }
            ],
            "2025-07-26": [
                { id: "task-2025-07-26-0", text: "Easy: Find Max/Min in Array (A2Z)", difficulty: "easy", completed: false },
                { id: "task-2025-07-26-1", text: "Hard: Longest Increasing Subsequence (DP)", difficulty: "hard", completed: false }
            ],
            "2025-07-27": [
                { id: "task-2025-07-27-0", text: "Review Week 2 / Rest", difficulty: "rest", completed: false }
            ],
            "2025-07-28": [
                { id: "task-2025-07-28-0", text: "Easy: Check if String is Palindrome (A2Z)", difficulty: "easy", completed: false },
                { id: "task-2025-07-28-1", text: "Medium: Rotate Array by K (A2Z)", difficulty: "medium", completed: false }
            ],
            "2025-07-29": [
                { id: "task-2025-07-29-0", text: "Medium: Majority Element (A2Z)", difficulty: "medium", completed: false },
                { id: "task-2025-07-29-1", text: "Hard: House Robber (DP)", difficulty: "hard", completed: false }
            ],
            "2025-07-30": [
                { id: "task-2025-07-30-0", text: "Easy: Find Nth Fibonacci (A2Z)", difficulty: "easy", completed: false },
                { id: "task-2025-07-30-1", text: "Medium: Longest Subarray with Sum K (A2Z)", difficulty: "medium", completed: false }
            ],
            "2025-07-31": [
                { id: "task-2025-07-31-0", text: "Hard: Buy and Sell Stock III (DP)", difficulty: "hard", completed: false }
            ],
            // August 2025
            "2025-08-01": [
                { id: "task-2025-08-01-0", text: "Easy: Check if Number is Palindrome (A2Z)", difficulty: "easy", completed: false },
                { id: "task-2025-08-01-1", text: "Medium: Two Sum (A2Z)", difficulty: "medium", completed: false }
            ],
            "2025-08-02": [
                { id: "task-2025-08-02-0", text: "Easy: Print all Patterns (A2Z)", difficulty: "easy", completed: false },
                { id: "task-2025-08-02-1", text: "Hard: Longest Common Substring (DP)", difficulty: "hard", completed: false }
            ],
            "2025-08-03": [
                { id: "task-2025-08-03-0", text: "Contest/Mock Interview / Rest", difficulty: "rest", completed: false }
            ],
            "2025-08-04": [
                { id: "task-2025-08-04-0", text: "Easy: Basic Recursion Problems (A2Z)", difficulty: "easy", completed: false },
                { id: "task-2025-08-04-1", text: "Medium: Count Inversions (A2Z)", difficulty: "medium", completed: false }
            ],
            "2025-08-05": [
                { id: "task-2025-08-05-0", text: "Medium: Kadane's Algorithm (A2Z)", difficulty: "medium", completed: false },
                { id: "task-2025-08-05-1", text: "Hard: Longest Common Substring (DP)", difficulty: "hard", completed: false }
            ],
            "2025-08-06": [
                { id: "task-2025-08-06-0", text: "Easy: Find Missing Number (A2Z)", difficulty: "easy", completed: false },
                { id: "task-2025-08-06-1", text: "Medium: Merge Overlapping Intervals (A2Z)", difficulty: "medium", completed: false }
            ],
            "2025-08-07": [
                { id: "task-2025-08-07-0", text: "Hard: Edit Distance (DP)", difficulty: "hard", completed: false }
            ],
            "2025-08-08": [
                { id: "task-2025-08-08-0", text: "Easy: Check if Array is Sorted (A2Z)", difficulty: "easy", completed: false },
                { id: "task-2025-08-08-1", text: "Medium: Set Matrix Zeroes (A2Z)", difficulty: "medium", completed: false }
            ],
            "2025-08-09": [
                { id: "task-2025-08-09-0", text: "Easy: Find Union of Two Sorted Arrays (A2Z)", difficulty: "easy", completed: false },
                { id: "task-2025-08-09-1", text: "Hard: Minimum Deletions to Make Palindrome (DP)", difficulty: "hard", completed: false }
            ],
            "2025-08-10": [
                { id: "task-2025-08-10-0", text: "Review July Topics / Rest", difficulty: "rest", completed: false }
            ],
            "2025-08-11": [
                { id: "task-2025-08-11-0", text: "Medium: Count Subarrays with Sum K (A2Z)", difficulty: "medium", completed: false },
                { id: "task-2025-08-11-1", text: "Hard: Longest Palindromic Substring (DP)", difficulty: "hard", completed: false }
            ],
            "2025-08-12": [
                { id: "task-2025-08-12-0", text: "Easy: Find Kth Permutation (Recursion)", difficulty: "easy", completed: false },
                { id: "task-2025-08-12-1", text: "Medium: Permutations (A2Z)", difficulty: "medium", completed: false }
            ],
            "2025-08-13": [
                { id: "task-2025-08-13-0", text: "Hard: Palindrome Partitioning (DP)", difficulty: "hard", completed: false }
            ],
            "2025-08-14": [
                { id: "task-2025-08-14-0", text: "Easy: Implement Stack using Arrays (A2Z)", difficulty: "easy", completed: false },
                { id: "task-2025-08-14-1", text: "Medium: Implement Queue using Stacks (A2Z)", difficulty: "medium", completed: false }
            ],
            "2025-08-15": [
                { id: "task-2025-08-15-0", text: "Easy: Implement Linked List (A2Z)", difficulty: "easy", completed: false },
                { id: "task-2025-08-15-1", text: "Hard: Reverse Nodes in k-Group (Linked List)", difficulty: "hard", completed: false }
            ],
            "2025-08-16": [
                { id: "task-2025-08-16-0", text: "Contest/Mock Interview / Rest", difficulty: "rest", completed: false }
            ],
            "2025-08-17": [
                { id: "task-2025-08-17-0", text: "Review August Topics / Rest", difficulty: "rest", completed: false }
            ],
            "2025-08-18": [
                { id: "task-2025-08-18-0", text: "Easy: Implement Binary Tree (A2Z)", difficulty: "easy", completed: false },
                { id: "task-2025-08-18-1", text: "Medium: Inorder Traversal (A2Z)", difficulty: "medium", completed: false }
            ],
            "2025-08-19": [
                { id: "task-2025-08-19-0", text: "Medium: Level Order Traversal (A2Z)", difficulty: "medium", completed: false },
                { id: "task-2025-08-19-1", text: "Hard: Max Path Sum in Binary Tree (A2Z)", difficulty: "hard", completed: false }
            ],
            "2025-08-20": [
                { id: "task-2025-08-20-0", text: "Easy: Implement Graph (Adjacency List) (A2Z)", difficulty: "easy", completed: false },
                { id: "task-2025-08-20-1", text: "Medium: BFS Traversal (A2Z)", difficulty: "medium", completed: false }
            ],
            "2025-08-21": [
                { id: "task-2025-08-21-0", text: "Hard: Detect Cycle in Undirected Graph (A2Z)", difficulty: "hard", completed: false }
            ],
            "2025-08-22": [
                { id: "task-2025-08-22-0", text: "Easy: Topological Sort (A2Z)", difficulty: "easy", completed: false },
                { id: "task-2025-08-22-1", text: "Medium: Dijkstra's Algorithm (A2Z)", difficulty: "medium", completed: false }
            ],
            "2025-08-23": [
                { id: "task-2025-08-23-0", text: "Easy: Implement Trie (A2Z)", difficulty: "easy", completed: false },
                { id: "task-2025-08-23-1", text: "Hard: Word Break (DP)", difficulty: "hard", completed: false }
            ],
            "2025-08-24": [
                { id: "task-2025-08-24-0", text: "Contest/Mock Interview / Rest", difficulty: "rest", completed: false }
            ],
            "2025-08-25": [
                { id: "task-2025-08-25-0", text: "Easy: Implement Heap (Min/Max) (A2Z)", difficulty: "easy", completed: false },
                { id: "task-2025-08-25-1", text: "Medium: Kth Largest Element in an Array (A2Z)", difficulty: "medium", completed: false }
            ],
            "2025-08-26": [
                { id: "task-2025-08-26-0", text: "Medium: Implement Hash Map (A2Z)", difficulty: "medium", completed: false },
                { id: "task-2025-08-26-1", text: "Hard: Design LRU Cache (A2Z)", difficulty: "hard", completed: false }
            ],
            "2025-08-27": [
                { id: "task-2025-08-27-0", text: "Easy: Implement Segment Tree (A2Z)", difficulty: "easy", completed: false },
                { id: "task-2025-08-27-1", text: "Hard: Range Sum Query - Mutable (A2Z)", difficulty: "hard", completed: false }
            ],
            "2025-08-28": [
                { id: "task-2025-08-28-0", text: "Hard: Minimum Spanning Tree (Prim's/Kruskal's) (A2Z)", difficulty: "hard", completed: false }
            ],
            "2025-08-29": [
                { id: "task-2025-08-29-0", text: "Easy: Implement Disjoint Set Union (A2Z)", difficulty: "easy", completed: false },
                { id: "task-2025-08-29-1", text: "Medium: Number of Provinces (A2Z)", difficulty: "medium", completed: false }
            ],
            "2025-08-30": [
                { id: "task-2025-08-30-0", text: "Easy: Backtracking Basics (A2Z)", difficulty: "easy", completed: false },
                { id: "task-2025-08-30-1", text: "Hard: N-Queens Problem (A2Z)", difficulty: "hard", completed: false }
            ],
            "2025-08-31": [
                { id: "task-2025-08-31-0", text: "Contest/Mock Interview / Rest", difficulty: "rest", completed: false }
            ],
            // September 2025
            "2025-09-01": [
                { id: "task-2025-09-01-0", text: "Easy: Bit Manipulation Basics (A2Z)", difficulty: "easy", completed: false },
                { id: "task-2025-09-01-1", text: "Medium: Single Number (A2Z)", difficulty: "medium", completed: false }
            ],
            "2025-09-02": [
                { id: "task-2025-09-02-0", text: "Medium: Power of Two (A2Z)", difficulty: "medium", completed: false },
                { id: "task-2025-09-02-1", text: "Hard: Sum of Two Integers (A2Z)", difficulty: "hard", completed: false }
            ],
            "2025-09-03": [
                { id: "task-2025-09-03-0", text: "Easy: Sliding Window Basics (A2Z)", difficulty: "easy", completed: false },
                { id: "task-2025-09-03-1", text: "Medium: Longest Substring Without Repeating Characters (A2Z)", difficulty: "medium", completed: false }
            ],
            "2025-09-04": [
                { id: "task-2025-09-04-0", text: "Hard: Minimum Window Substring (A2Z)", difficulty: "hard", completed: false }
            ],
            "2025-09-05": [
                { id: "task-2025-09-05-0", text: "Easy: Two Pointers Basics (A2Z)", difficulty: "easy", completed: false },
                { id: "task-2025-09-05-1", text: "Medium: 3Sum (A2Z)", difficulty: "medium", completed: false }
            ],
            "2025-09-06": [
                { id: "task-2025-09-06-0", text: "Easy: Binary Search Basics (A2Z)", difficulty: "easy", completed: false },
                { id: "task-2025-09-06-1", text: "Hard: Search in Rotated Sorted Array (A2Z)", difficulty: "hard", completed: false }
            ],
            "2025-09-07": [
                { id: "task-2025-09-07-0", text: "Review August Topics / Rest", difficulty: "rest", completed: false }
            ],
            "2025-09-08": [
                { id: "task-2025-09-08-0", text: "Easy: Implement Stack using Linked List (A2Z)", difficulty: "easy", completed: false },
                { id: "task-2025-09-08-1", text: "Medium: Valid Parentheses (A2Z)", difficulty: "medium", completed: false }
            ],
            "2025-09-09": [
                { id: "task-2025-09-09-0", text: "Medium: Next Greater Element (A2Z)", difficulty: "medium", completed: false },
                { id: "task-2025-09-09-1", text: "Hard: Largest Rectangle in Histogram (A2Z)", difficulty: "hard", completed: false }
            ],
            "2025-09-10": [
                { id: "task-2025-09-10-0", text: "Easy: Implement Queue using Arrays (A2Z)", difficulty: "easy", completed: false },
                { id: "task-2025-09-10-1", text: "Medium: Circular Queue (A2Z)", difficulty: "medium", completed: false }
            ],
            "2025-09-11": [
                { id: "task-2025-09-11-0", text: "Hard: Sliding Window Maximum (A2Z)", difficulty: "hard", completed: false }
            ],
            "2025-09-12": [
                { id: "task-2025-09-12-0", text: "Easy: Implement Doubly Linked List (A2Z)", difficulty: "easy", completed: false },
                { id: "task-2025-09-12-1", text: "Medium: Add Two Numbers (Linked List) (A2Z)", difficulty: "medium", completed: false }
            ],
            "2025-09-13": [
                { id: "task-2025-09-13-0", text: "Easy: Detect Cycle in Linked List (A2Z)", difficulty: "easy", completed: false },
                { id: "task-2025-09-13-1", text: "Hard: Merge K Sorted Lists (A2Z)", difficulty: "hard", completed: false }
            ],
            "2025-09-14": [
                { id: "task-2025-09-14-0", text: "Contest/Mock Interview / Rest", difficulty: "rest", completed: false }
            ],
            "2025-09-15": [
                { id: "task-2025-09-15-0", text: "Easy: Symmetric Tree (A2Z)", difficulty: "easy", completed: false },
                { id: "task-2025-09-15-1", text: "Medium: Diameter of Binary Tree (A2Z)", difficulty: "medium", completed: false }
            ],
            "2025-09-16": [
                { id: "task-2025-09-16-0", text: "Medium: Lowest Common Ancestor (A2Z)", difficulty: "medium", completed: false },
                { id: "task-2025-09-16-1", text: "Hard: Serialize/Deserialize Binary Tree (A2Z)", difficulty: "hard", completed: false }
            ],
            "2025-09-17": [
                { id: "task-2025-09-17-0", text: "Easy: Clone Graph (A2Z)", difficulty: "easy", completed: false },
                { id: "task-2025-09-17-1", text: "Medium: Number of Islands (A2Z)", difficulty: "medium", completed: false }
            ],
            "2025-09-18": [
                { id: "task-2025-09-18-0", text: "Hard: Alien Dictionary (A2Z)", difficulty: "hard", completed: false }
            ],
            "2025-09-19": [
                { id: "task-2025-09-19-0", text: "Easy: K-th Smallest Element in BST (A2Z)", difficulty: "easy", completed: false },
                { id: "task-2025-09-19-1", text: "Medium: Validate Binary Search Tree (A2Z)", difficulty: "medium", completed: false }
            ],
            "2025-09-20": [
                { id: "task-2025-09-20-0", text: "Easy: Implement Min Stack (A2Z)", difficulty: "easy", completed: false },
                { id: "task-2025-09-20-1", text: "Hard: Trapping Rain Water (A2Z)", difficulty: "hard", completed: false }
            ],
            "2025-09-21": [
                { id: "task-2025-09-21-0", text: "Review September Week 1 / Rest", difficulty: "rest", completed: false }
            ],
            "2025-09-22": [
                { id: "task-2025-09-22-0", text: "Easy: Find Peak Element (A2Z)", difficulty: "easy", completed: false },
                { id: "task-2025-09-22-1", text: "Medium: Find Minimum in Rotated Sorted Array (A2Z)", difficulty: "medium", completed: false }
            ],
            "2025-09-23": [
                { id: "task-2025-09-23-0", text: "Medium: Search a 2D Matrix (A2Z)", difficulty: "medium", completed: false },
                { id: "task-2025-09-23-1", text: "Hard: Median of Two Sorted Arrays (A2Z)", difficulty: "hard", completed: false }
            ],
            "2025-09-24": [
                { id: "task-2025-09-24-0", text: "Easy: Subsets (A2Z)", difficulty: "easy", completed: false },
                { id: "task-2025-09-24-1", text: "Medium: Combination Sum (A2Z)", difficulty: "medium", completed: false }
            ],
            "2025-09-25": [
                { id: "task-2025-09-25-0", text: "Hard: Sudoku Solver (A2Z)", difficulty: "hard", completed: false }
            ],
            "2025-09-26": [
                { id: "task-2025-09-26-0", text: "Easy: Implement Hash Set (A2Z)", difficulty: "easy", completed: false },
                { id: "task-2025-09-26-1", text: "Medium: Longest Consecutive Sequence (A2Z)", difficulty: "medium", completed: false }
            ],
            "2025-09-27": [
                { id: "task-2025-09-27-0", text: "Easy: Implement Binary Search Tree (A2Z)", difficulty: "easy", completed: false },
                { id: "task-2025-09-27-1", text: "Hard: Construct Binary Tree from Preorder and Inorder Traversal (A2Z)", difficulty: "hard", completed: false }
            ],
            "2025-09-28": [
                { id: "task-2025-09-28-0", text: "Contest/Mock Interview / Rest", difficulty: "rest", completed: false }
            ],
            "2025-09-29": [
                { id: "task-2025-09-29-0", text: "Medium: Sieve of Eratosthenes (A2Z)", difficulty: "medium", completed: false },
                { id: "task-2025-09-29-1", text: "Hard: Number of Ways to Partition a String (DP)", difficulty: "hard", completed: false }
            ],
            "2025-09-30": [
                { id: "task-2025-09-30-0", text: "Easy: Implement HashMap with Chaining (A2Z)", difficulty: "easy", completed: false },
                { id: "task-2025-09-30-1", text: "Medium: Implement Trie with Prefix Search (A2Z)", difficulty: "medium", completed: false }
            ],
            // October 2025
            "2025-10-01": [
                { id: "task-2025-10-01-0", text: "Easy: Bit Manipulation Basics", difficulty: "easy", completed: false },
                { id: "task-2025-10-01-1", text: "Medium: Single Number", difficulty: "medium", completed: false }
            ],
            "2025-10-02": [
                { id: "task-2025-10-02-0", text: "Medium: Power of Two", difficulty: "medium", completed: false },
                { id: "task-2025-10-02-1", text: "Hard: Sum of Two Integers (Bitwise)", difficulty: "hard", completed: false }
            ],
            "2025-10-03": [
                { id: "task-2025-10-03-0", text: "Easy: Sliding Window Introduction", difficulty: "easy", completed: false },
                { id: "task-2025-10-03-1", text: "Medium: Longest Substring Without Repeating Characters", difficulty: "medium", completed: false }
            ],
            "2025-10-04": [
                { id: "task-2025-10-04-0", text: "Hard: Minimum Window Substring", difficulty: "hard", completed: false }
            ],
            "2025-10-05": [
                { id: "task-2025-10-05-0", text: "Contest/Mock Interview / Rest", difficulty: "rest", completed: false }
            ],
            "2025-10-06": [
                { id: "task-2025-10-06-0", text: "Easy: Two Pointers Introduction", difficulty: "easy", completed: false },
                { id: "task-2025-10-06-1", text: "Medium: 3Sum", difficulty: "medium", completed: false }
            ],
            "2025-10-07": [
                { id: "task-2025-10-07-0", text: "Easy: Binary Search Basics", difficulty: "easy", completed: false },
                { id: "task-2025-10-07-1", text: "Hard: Search in Rotated Sorted Array", difficulty: "hard", completed: false }
            ],
            "2025-10-08": [
                { id: "task-2025-10-08-0", text: "Medium: Search a 2D Matrix", difficulty: "medium", completed: false },
                { id: "task-2025-10-08-1", text: "Hard: Median of Two Sorted Arrays", difficulty: "hard", completed: false }
            ],
            "2025-10-09": [
                { id: "task-2025-10-09-0", text: "Easy: Implement Stack (Linked List)", difficulty: "easy", completed: false },
                { id: "task-2025-10-09-1", text: "Medium: Valid Parentheses", difficulty: "medium", completed: false }
            ],
            "2025-10-10": [
                { id: "task-2025-10-10-0", text: "Medium: Next Greater Element", difficulty: "medium", completed: false },
                { id: "task-2025-10-10-1", text: "Hard: Largest Rectangle in Histogram", difficulty: "hard", completed: false }
            ],
            "2025-10-11": [
                { id: "task-2025-10-11-0", text: "Easy: Implement Queue (Arrays)", difficulty: "easy", completed: false },
                { id: "task-2025-10-11-1", text: "Medium: Circular Queue", difficulty: "medium", completed: false }
            ],
            "2025-10-12": [
                { id: "task-2025-10-12-0", text: "Contest/Mock Interview / Rest", difficulty: "rest", completed: false }
            ],
            "2025-10-13": [
                { id: "task-2025-10-13-0", text: "Hard: Sliding Window Maximum", difficulty: "hard", completed: false }
            ],
            "2025-10-14": [
                { id: "task-2025-10-14-0", text: "Easy: Implement Doubly Linked List", difficulty: "easy", completed: false },
                { id: "task-2025-10-14-1", text: "Medium: Add Two Numbers (Linked List)", difficulty: "medium", completed: false }
            ],
            "2025-10-15": [
                { id: "task-2025-10-15-0", text: "Easy: Detect Cycle in Linked List", difficulty: "easy", completed: false },
                { id: "task-2025-10-15-1", text: "Hard: Merge K Sorted Lists", difficulty: "hard", completed: false }
            ],
            "2025-10-16": [
                { id: "task-2025-10-16-0", text: "Easy: Symmetric Tree", difficulty: "easy", completed: false },
                { id: "task-2025-10-16-1", text: "Medium: Diameter of Binary Tree (A2Z)", difficulty: "medium", completed: false }
            ],
            "2025-10-17": [
                { id: "task-2025-10-17-0", text: "Medium: Lowest Common Ancestor", difficulty: "medium", completed: false },
                { id: "task-2025-10-17-1", text: "Hard: Serialize/Deserialize Binary Tree (A2Z)", difficulty: "hard", completed: false }
            ],
            "2025-10-18": [
                { id: "task-2025-10-18-0", text: "Easy: Clone Graph (A2Z)", difficulty: "easy", completed: false },
                { id: "task-2025-10-18-1", text: "Medium: Number of Islands (A2Z)", difficulty: "medium", completed: false }
            ],
            "2025-10-19": [
                { id: "task-2025-10-19-0", text: "Contest/Mock Interview / Rest", difficulty: "rest", completed: false }
            ],
            "2025-10-20": [
                { id: "task-2025-10-20-0", text: "Hard: Alien Dictionary", difficulty: "hard", completed: false }
            ],
            "2025-10-21": [
                { id: "task-2025-10-21-0", text: "Easy: K-th Smallest Element in BST (A2Z)", difficulty: "easy", completed: false },
                { id: "task-2025-10-21-1", text: "Medium: Validate Binary Search Tree (A2Z)", difficulty: "medium", completed: false }
            ],
            "2025-10-22": [
                { id: "task-2025-10-22-0", text: "Easy: Implement Min Stack (A2Z)", difficulty: "easy", completed: false },
                { id: "task-2025-10-22-1", text: "Hard: Trapping Rain Water (A2Z)", difficulty: "hard", completed: false }
            ],
            "2025-10-23": [
                { id: "task-2025-10-23-0", text: "Easy: Find Peak Element (A2Z)", difficulty: "easy", completed: false },
                { id: "task-2025-10-23-1", text: "Medium: Find Minimum in Rotated Sorted Array (A2Z)", difficulty: "medium", completed: false }
            ],
            "2025-10-24": [
                { id: "task-2025-10-24-0", text: "Easy: Subsets (Backtracking)", difficulty: "easy", completed: false },
                { id: "task-2025-10-24-1", text: "Medium: Combination Sum (Backtracking)", difficulty: "medium", completed: false }
            ],
            "2025-10-25": [
                { id: "task-2025-10-25-0", text: "Hard: Sudoku Solver (A2Z)", difficulty: "hard", completed: false }
            ],
            "2025-10-26": [
                { id: "task-2025-10-26-0", text: "Contest/Mock Interview / Rest", difficulty: "rest", completed: false }
            ],
            "2025-10-27": [
                { id: "task-2025-10-27-0", text: "Easy: Implement Hash Set (A2Z)", difficulty: "easy", completed: false },
                { id: "task-2025-12-27-1", text: "Medium: Longest Consecutive Sequence (A2Z)", difficulty: "medium", completed: false }
            ],
            "2025-10-28": [
                { id: "task-2025-10-28-0", text: "Easy: Implement Binary Search Tree (A2Z)", difficulty: "easy", completed: false },
                { id: "task-2025-10-28-1", text: "Hard: Construct Binary Tree from Preorder and Inorder Traversal (A2Z)", difficulty: "hard", completed: false }
            ],
            "2025-10-29": [
                { id: "task-2025-10-29-0", text: "Medium: Sieve of Eratosthenes", difficulty: "medium", completed: false },
                { id: "task-2025-10-29-1", text: "Hard: Number of Ways to Partition a String (DP)", difficulty: "hard", completed: false }
            ],
            "2025-10-30": [
                { id: "task-2025-10-30-0", text: "Easy: Implement HashMap with Chaining (A2Z)", difficulty: "easy", completed: false },
                { id: "task-2025-10-30-1", text: "Medium: Implement Trie with Prefix Search (A2Z)", difficulty: "medium", completed: false }
            ],
            "2025-10-31": [
                { id: "task-2025-10-31-0", text: "Review October Topics / Rest", difficulty: "rest", completed: false }
            ],
            // November 2025
            "2025-11-01": [
                { id: "task-2025-11-01-0", text: "Contest/Mock Interview", difficulty: "rest", completed: false }
            ],
            "2025-11-02": [
                { id: "task-2025-11-02-0", text: "Rest/Review", difficulty: "rest", completed: false }
            ],
            "2025-11-03": [
                { id: "task-2025-11-03-0", text: "Medium: Unbounded Knapsack (DP)", difficulty: "medium", completed: false },
                { id: "task-2025-11-03-1", text: "Hard: Rod Cutting Problem (DP)", difficulty: "hard", completed: false }
            ],
            "2025-11-04": [
                { id: "task-2025-11-04-0", text: "Medium: Minimum Coins (DP)", difficulty: "medium", completed: false },
                { id: "task-2025-11-04-1", text: "Hard: Target Sum (DP)", difficulty: "hard", completed: false }
            ],
            "2025-11-05": [
                { id: "task-2025-11-05-0", text: "Medium: Coin Change 2 (DP)", difficulty: "medium", completed: false },
                { id: "task-2025-11-05-1", text: "Hard: Longest Common Subsequence (DP)", difficulty: "hard", completed: false }
            ],
            "2025-11-06": [
                { id: "task-2025-11-06-0", text: "Easy: Basic Graph Algorithms (DFS/BFS refresh)", difficulty: "easy", completed: false },
                { id: "task-2025-11-06-1", text: "Medium: Shortest Path in Binary Matrix (BFS)", difficulty: "medium", completed: false }
            ],
            "2025-11-07": [
                { id: "task-2025-11-07-0", text: "Hard: All Paths From Source to Target (DFS/Backtracking)", difficulty: "hard", completed: false },
                { id: "task-2025-11-07-1", text: "Hard: Network Delay Time (Dijkstra's advanced)", difficulty: "hard", completed: false }
            ],
            "2025-11-08": [
                { id: "task-2025-11-08-0", text: "Contest/Mock Interview", difficulty: "rest", completed: false }
            ],
            "2025-11-09": [
                { id: "task-2025-11-09-0", text: "Rest/Review", difficulty: "rest", completed: false }
            ],
            "2025-11-10": [
                { id: "task-2025-11-10-0", text: "Medium: K-th Smallest Element in Sorted Matrix (Binary Search)", difficulty: "medium", completed: false },
                { id: "task-2025-11-10-1", text: "Hard: Find K Pairs with Smallest Sums (Heap/Two Pointers)", difficulty: "hard", completed: false }
            ],
            "2025-11-11": [
                { id: "task-2025-11-11-0", text: "Medium: Find K Closest Elements (Binary Search/Two Pointers)", difficulty: "medium", completed: false },
                { id: "task-2025-11-11-1", text: "Hard: Max Sum of Rectangle No Larger Than K (Prefix Sum/Binary Search)", difficulty: "hard", completed: false }
            ],
            "2025-11-12": [
                { id: "task-2025-11-12-0", text: "Medium: Longest Increasing Path in a Matrix (DP/DFS)", difficulty: "medium", completed: false },
                { id: "task-2025-11-12-1", text: "Hard: Count Vowels Permutation (DP)", difficulty: "hard", completed: false }
            ],
            "2025-11-13": [
                { id: "task-2025-11-13-0", text: "Medium: Word Search (Backtracking)", difficulty: "medium", completed: false },
                { id: "task-2025-11-13-1", text: "Hard: Regular Expression Matching (DP)", difficulty: "hard", completed: false }
            ],
            "2025-11-14": [
                { id: "task-2025-11-14-0", text: "Medium: Combination Sum II (Backtracking)", difficulty: "medium", completed: false },
                { id: "task-2025-11-14-1", text: "Hard: Permutations II (Backtracking)", difficulty: "hard", completed: false }
            ],
            "2025-11-15": [
                { id: "task-2025-11-15-0", text: "Contest/Mock Interview", difficulty: "rest", completed: false }
            ],
            "2025-11-16": [
                { id: "task-2025-11-16-0", text: "Rest/Review", difficulty: "rest", completed: false }
            ],
            "2025-11-17": [
                { id: "task-2025-11-17-0", text: "Medium: Course Schedule (Graph/Topological Sort)", difficulty: "medium", completed: false },
                { id: "task-2025-11-17-1", text: "Hard: Find the City With the Smallest Number of Neighbors (Floyd-Warshall/Graph)", difficulty: "hard", completed: false }
            ],
            "2025-11-18": [
                { id: "task-2025-11-18-0", text: "Medium: Cheapest Flights Within K Stops (Bellman-Ford/Graph)", difficulty: "medium", completed: false },
                { id: "task-2025-11-18-1", text: "Hard: Minimum Cost to Connect All Points (MST)", difficulty: "hard", completed: false }
            ],
            "2025-11-19": [
                { id: "task-2025-11-19-0", text: "Medium: Design Circular Deque (Data Structure)", difficulty: "medium", completed: false },
                { id: "task-2025-11-19-1", text: "Hard: Design a Leaderboard (Data Structure/Heap/Map)", difficulty: "hard", completed: false }
            ],
            "2025-11-20": [
                { id: "task-2025-11-20-0", text: "Medium: Design Add and Search Words Data Structure (Trie)", difficulty: "medium", completed: false },
                { id: "task-2025-11-20-1", text: "Hard: Implement Magic Dictionary (Trie)", difficulty: "hard", completed: false }
            ],
            "2025-11-21": [
                { id: "task-2025-11-21-0", text: "Medium: Flatten Binary Tree to Linked List (Tree Traversal)", difficulty: "medium", completed: false },
                { id: "task-2025-11-21-1", text: "Hard: Binary Tree Maximum Path Sum (Tree DP)", difficulty: "hard", completed: false }
            ],
            "2025-11-22": [
                { id: "task-2025-11-22-0", text: "Contest/Mock Interview", difficulty: "rest", completed: false }
            ],
            "2025-11-23": [
                { id: "task-2025-11-23-0", text: "Rest/Review", difficulty: "rest", completed: false }
            ],
            "2025-11-24": [
                { id: "task-2025-11-24-0", text: "Medium: Serialize and Deserialize BST (Tree)", difficulty: "medium", completed: false },
                { id: "task-2025-11-24-1", text: "Hard: Recover Binary Search Tree (Tree)", difficulty: "hard", completed: false }
            ],
            "2025-11-25": [
                { id: "task-2025-11-25-0", text: "Medium: Count Complete Tree Nodes (Binary Search on Tree)", difficulty: "medium", completed: false },
                { id: "task-2025-11-25-1", text: "Hard: Binary Tree Cameras (Tree DP)", difficulty: "hard", completed: false }
            ],
            "2025-11-26": [
                { id: "task-2025-11-26-0", text: "Medium: Smallest Subtree with all Deepest Nodes (Tree)", difficulty: "medium", completed: false },
                { id: "task-2025-11-26-1", text: "Hard: All Nodes Distance K in Binary Tree (BFS/Tree)", difficulty: "hard", completed: false }
            ],
            "2025-11-27": [
                { id: "task-2025-11-27-0", text: "Medium: Find K-th Smallest Pair Distance (Binary Search)", difficulty: "medium", completed: false },
                { id: "task-2025-11-27-1", text: "Hard: Find K Pairs with Smallest Sums (Heap/Two Pointers)", difficulty: "hard", completed: false }
            ],
            "2025-11-28": [
                { id: "task-2025-11-28-0", text: "Medium: Find K-th Smallest Prime Fraction (Binary Search)", difficulty: "medium", completed: false },
                { id: "task-2025-11-28-1", text: "Hard: Find K-th Smallest Number in Multiplication Table (Binary Search)", difficulty: "hard", completed: false }
            ],
            "2025-11-29": [
                { id: "task-2025-11-29-0", text: "Contest/Mock Interview", difficulty: "rest", completed: false }
            ],
            "2025-11-30": [
                { id: "task-2025-11-30-0", text: "Rest/Review", difficulty: "rest", completed: false }
            ],
            // December 2025
            "2025-12-01": [
                { id: "task-2025-12-01-0", text: "Medium: Valid Sudoku (Backtracking/Matrix)", difficulty: "medium", completed: false },
                { id: "task-2025-12-01-1", text: "Hard: N-Queens II (Backtracking)", difficulty: "hard", completed: false }
            ],
            "2025-12-02": [
                { id: "task-2025-12-02-0", text: "Medium: Word Ladder (BFS/Graph)", difficulty: "medium", completed: false },
                { id: "task-2025-12-02-1", text: "Hard: Word Ladder II (BFS/Graph)", difficulty: "hard", completed: false }
            ],
            "2025-12-03": [
                { id: "task-2025-12-03-0", text: "Medium: Longest Increasing Subsequence (DP - variation)", difficulty: "medium", completed: false },
                { id: "task-2025-12-03-1", text: "Hard: Russian Doll Envelopes (DP/LIS variation)", difficulty: "hard", completed: false }
            ],
            "2025-12-04": [
                { id: "task-2025-12-04-0", text: "Medium: Burst Balloons (DP)", difficulty: "medium", completed: false },
                { id: "task-2025-12-04-1", text: "Hard: Minimum Cost to Cut a Stick (DP)", difficulty: "hard", completed: false }
            ],
            "2025-12-05": [
                { id: "task-2025-12-05-0", text: "Medium: Longest Common Subsequence (DP - variation)", difficulty: "medium", completed: false },
                { id: "task-2025-12-05-1", text: "Hard: Shortest Common Supersequence (DP)", difficulty: "hard", completed: false }
            ],
            "2025-12-06": [
                { id: "task-2025-12-06-0", text: "Contest/Mock Interview", difficulty: "rest", completed: false }
            ],
            "2025-12-07": [
                { id: "task-2025-12-07-0", text: "Rest/Review", difficulty: "rest", completed: false }
            ],
            "2025-12-08": [
                { id: "task-2025-12-08-0", text: "Medium: Count Vowels Permutation (DP)", difficulty: "medium", completed: false },
                { id: "task-2025-12-08-1", text: "Hard: Number of Ways to Stay in Same Place (DP)", difficulty: "hard", completed: false }
            ],
            "2025-12-09": [
                { id: "task-2025-12-09-0", text: "Medium: Minimum Falling Path Sum (DP)", difficulty: "medium", completed: false },
                { id: "task-2025-12-09-1", text: "Hard: Cherry Pickup (DP)", difficulty: "hard", completed: false }
            ],
            "2025-12-10": [
                { id: "task-2025-12-10-0", text: "Medium: Unique Paths III (Backtracking)", difficulty: "medium", completed: false },
                { id: "task-2025-12-10-1", text: "Hard: The Number of Good Paths (Graph/DSU)", difficulty: "hard", completed: false }
            ],
            "2025-12-11": [
                { id: "task-2025-12-11-0", text: "Medium: Find Eventual Safe States (Graph/DFS)", difficulty: "medium", completed: false },
                { id: "task-2025-12-11-1", text: "Hard: Critical Connections in a Network (Graph/Tarjan's)", difficulty: "hard", completed: false }
            ],
            "2025-12-12": [
                { id: "task-2025-12-12-0", text: "Medium: Reorder Routes to Make All Paths Lead to Zero (Graph/BFS/DFS)", difficulty: "medium", completed: false },
                { id: "task-2025-12-12-1", text: "Hard: Number of Ways to Arrive at Destination (Graph/Dijkstra's)", difficulty: "hard", completed: false }
            ],
            "2025-12-13": [
                { id: "task-2025-12-13-0", text: "Contest/Mock Interview", difficulty: "rest", completed: false }
            ],
            "2025-12-14": [
                { id: "task-2025-12-14-0", text: "Rest/Review", difficulty: "rest", completed: false }
            ],
            "2025-12-15": [
                { id: "task-2025-12-15-0", text: "Medium: Design a HashMap (Conceptual/System Design)", difficulty: "medium", completed: false },
                { id: "task-2025-12-15-1", text: "Hard: Design a Tic-Tac-Toe (System Design)", difficulty: "hard", completed: false }
            ],
            "2025-12-16": [
                { id: "task-2025-12-16-0", text: "Medium: Design a Stack With Increment Operation (Data Structure)", difficulty: "medium", completed: false },
                { id: "task-2025-12-16-1", text: "Hard: Design a Search Autocomplete System (Trie/Design)", difficulty: "hard", completed: false }
            ],
            "2025-12-17": [
                { id: "task-2025-12-17-0", text: "Medium: Design a Number Container System (Data Structure)", difficulty: "medium", completed: false },
                { id: "task-22025-12-17-1", text: "Hard: Design a Food Rating System (Data Structure/Design)", difficulty: "hard", completed: false }
            ],
            "2025-12-18": [
                { id: "task-2025-12-18-0", text: "Medium: Design a File System (Tree/Trie)", difficulty: "medium", completed: false },
                { id: "task-2025-12-18-1", text: "Hard: Design a Skiplist (Data Structure)", difficulty: "hard", completed: false }
            ],
            "2025-12-19": [
                { id: "task-2025-12-19-0", text: "Medium: Design a HashSet (Conceptual/System Design)", difficulty: "medium", completed: false },
                { id: "task-2025-12-19-1", text: "Hard: Design a Circular Queue (Conceptual/System Design)", difficulty: "hard", completed: false }
            ],
            "2025-12-20": [
                { id: "task-2025-12-20-0", text: "Contest/Mock Interview", difficulty: "rest", completed: false }
            ],
            "2025-12-21": [
                { id: "task-2025-12-21-0", text: "Rest/Review", difficulty: "rest", completed: false }
            ],
            "2025-12-22": [
                { id: "task-2025-12-22-0", text: "Comprehensive Review of Arrays & Strings", difficulty: "easy", completed: false }
            ],
            "2025-12-23": [
                { id: "task-2025-12-23-0", text: "Comprehensive Review of Linked Lists & Stacks/Queues", difficulty: "easy", completed: false }
            ],
            "2025-12-24": [
                { id: "task-2025-12-24-0", text: "Comprehensive Review of Trees & BSTs", difficulty: "easy", completed: false }
            ],
            "2025-12-25": [
                { id: "task-2025-12-25-0", text: "Comprehensive Review of Graphs & DP (Part 1)", difficulty: "easy", completed: false }
            ],
            "2025-12-26": [
                { id: "task-2025-12-26-0", text: "Comprehensive Review of DP (Part 2) & Backtracking", difficulty: "easy", completed: false }
            ],
            "2025-12-27": [
                { id: "task-2025-12-27-0", text: "Final Mock Interview Marathon", difficulty: "rest", completed: false }
            ],
            "2025-12-28": [
                { id: "task-2025-12-28-0", text: "Final Review / Rest", difficulty: "rest", completed: false }
            ],
            "2025-12-29": [
                { id: "task-2025-12-29-0", text: "Final Mock Interview Marathon", difficulty: "rest", completed: false }
            ],
            "2025-12-30": [
                { id: "task-2025-12-30-0", text: "Final Review / Rest", difficulty: "rest", completed: false }
            ],
            "2025-12-31": [
                { id: "task-2025-12-31-0", text: "Celebrate!", difficulty: "rest", completed: false }
            ]
        };

        // Function to save a task to Firestore
        async function saveTaskToFirestore(task) {
            if (!window.db || !window.userId) {
                console.error("Firestore not initialized or user not authenticated.");
                return;
            }
            try {
                // Use the hardcoded appId for the collection path
                const taskRef = doc(window.db, `artifacts/${appId}/users/${window.userId}/dsa_tasks`, task.id);
                await setDoc(taskRef, task, { merge: true }); // Use merge: true to update existing fields
                console.log("Task saved:", task.id);
            } catch (e) {
                console.error("Error saving task:", e);
            }
        }

        // Function to update a task's date in Firestore
        async function updateTaskDateInFirestore(taskId, oldDate, newDate) {
            if (!window.db || !window.userId) {
                console.error("Firestore not initialized or user not authenticated.");
                return;
            }
            try {
                // Fetch the task to ensure it exists and get its current data
                // Use the hardcoded appId for the collection path
                const taskRef = doc(window.db, `artifacts/${appId}/users/${window.userId}/dsa_tasks`, taskId);
                const taskSnap = await getDoc(taskRef);

                if (taskSnap.exists()) {
                    const taskData = taskSnap.data();
                    taskData.date = newDate; // Update the date field
                    await setDoc(taskRef, taskData); // Save the updated task
                    console.log(`Task ${taskId} moved from ${oldDate} to ${newDate}`);
                } else {
                    console.warn(`Task ${taskId} not found in Firestore.`);
                }
            } catch (e) {
                console.error("Error updating task date:", e);
            }
        }

        // Function to update a task's completion status in Firestore
        async function updateTaskCompletionInFirestore(taskId, completedStatus) {
            if (!window.db || !window.userId) {
                console.error("Firestore not initialized or user not authenticated.");
                return;
            }
            try {
                // Use the hardcoded appId for the collection path
                const taskRef = doc(window.db, `artifacts/${appId}/users/${window.userId}/dsa_tasks`, taskId);
                await updateDoc(taskRef, { completed: completedStatus });
                console.log(`Task ${taskId} completion status updated to ${completedStatus}`);
            } catch (e) {
                console.error("Error updating task completion:", e);
            }
        }

        // Function to load tasks from Firestore
        async function loadTasksFromFirestore() {
            if (!window.db || !window.userId) {
                console.error("Firestore not initialized or user not authenticated. Cannot load tasks.");
                return;
            }

            const loadingOverlay = document.getElementById('loading-overlay');
            loadingOverlay.style.display = 'flex'; // Show loading overlay

            try {
                // Use the hardcoded appId for the collection path
                const tasksColRef = collection(window.db, `artifacts/${appId}/users/${window.userId}/dsa_tasks`);
                const q = query(tasksColRef);

                onSnapshot(q, (snapshot) => {
                    tasks = {}; // Clear existing tasks
                    if (snapshot.empty) {
                        console.log("No tasks found in Firestore. Populating with initial static data.");
                        // If no tasks, populate with initial static data
                        populateInitialTasks();
                    } else {
                        snapshot.forEach(doc => {
                            const task = doc.data();
                            if (!tasks[task.date]) {
                                tasks[task.date] = [];
                            }
                            tasks[task.date].push(task);
                        });
                        console.log("Tasks loaded from Firestore:", tasks);
                        renderCalendar(currentMonth, currentYear, currentView); // Re-render calendar after loading
                    }
                    loadingOverlay.style.display = 'none'; // Hide loading overlay
                }, (error) => {
                    console.error("Error listening to tasks:", error);
                    loadingOverlay.style.display = 'none'; // Hide loading overlay on error
                });
            } catch (e) {
                console.error("Error loading tasks:", e);
                loadingOverlay.style.display = 'none'; // Hide loading overlay on error
            }
        }

        // Function to populate initial tasks into Firestore if the collection is empty
        async function populateInitialTasks() {
            if (!window.db || !window.userId) {
                console.error("Firestore not initialized or user not authenticated.");
                return;
            }
            // Use the hardcoded appId for the collection path
            const tasksColRef = collection(window.db, `artifacts/${appId}/users/${window.userId}/dsa_tasks`);
            const snapshot = await getDocs(tasksColRef); // getDocs is now imported
            if (snapshot.empty) {
                console.log("Populating initial static tasks to Firestore...");
                const batch = writeBatch(window.db); // Get a new write batch
                for (const date in initialStaticTasks) {
                    for (const task of initialStaticTasks[date]) {
                        const taskRef = doc(window.db, `artifacts/${appId}/users/${window.userId}/dsa_tasks`, task.id);
                        batch.set(taskRef, { ...task, date: date }); // Add each task to the batch
                    }
                }
                try {
                    await batch.commit(); // Commit the batch
                    console.log("Initial static tasks populated via batch write.");
                } catch (e) {
                    console.error("Error committing initial tasks batch:", e);
                }
            }
        }


        function renderCalendar(month, year, viewType) {
            const calendarGrid = document.getElementById('calendarGrid');
            const currentPeriodDisplay = document.getElementById('currentPeriodDisplay');
            calendarGrid.innerHTML = ''; // Clear previous days

            // Clear existing day headers and re-add them for consistent structure
            const existingHeaders = document.querySelectorAll('.calendar-day-header');
            existingHeaders.forEach(header => header.remove());

            const dayHeadersContainer = document.querySelector('.calendar-grid.mb-4');
            const daysOfWeek = ["Mon", "Tue", "Wed", "Thu", "Fri", "Sat", "Sun"];
            daysOfWeek.forEach(dayName => {
                const header = document.createElement('div');
                header.classList.add('calendar-day-header');
                header.textContent = dayName;
                dayHeadersContainer.appendChild(header);
            });


            if (viewType === 'month') {
                currentPeriodDisplay.textContent = `${monthNames[month]} ${year}`;
                calendarGrid.style.gridTemplateColumns = 'repeat(7, minmax(0, 1fr))'; // Ensure 7 columns

                const firstDayOfMonth = new Date(year, month, 1).getDay(); // 0 for Sunday, 1 for Monday
                const daysInMonth = new Date(year, month + 1, 0).getDate();

                const startDay = (firstDayOfMonth === 0) ? 6 : firstDayOfMonth - 1; // Adjust to start Monday

                for (let i = 0; i < startDay; i++) {
                    const emptyCell = document.createElement('div');
                    emptyCell.classList.add('calendar-day-cell', 'empty');
                    calendarGrid.appendChild(emptyCell);
                }

                for (let day = 1; day <= daysInMonth; day++) {
                    const dateString = `${year}-${String(month + 1).padStart(2, '0')}-${String(day).padStart(2, '0')}`;
                    const dayCell = createDayCell(dateString, month, day);
                    calendarGrid.appendChild(dayCell);
                }
            } else if (viewType === 'week') {
                // Determine the Monday of the current week
                let date = new Date(currentWeekStartDate);
                let dayOfWeek = date.getDay(); // 0 for Sunday, 1 for Monday
                let diff = date.getDate() - dayOfWeek + (dayOfWeek === 0 ? -6 : 1); // Adjust to Monday
                date.setDate(diff); // This is the Monday of the week

                const weekEndDate = new Date(date);
                weekEndDate.setDate(date.getDate() + 6); // Calculate Sunday of the week

                currentPeriodDisplay.textContent = `Week of ${monthNames[date.getMonth()]} ${date.getDate()}, ${date.getFullYear()} - ${monthNames[weekEndDate.getMonth()]} ${weekEndDate.getDate()}, ${weekEndDate.getFullYear()}`;
                calendarGrid.style.gridTemplateColumns = 'repeat(7, minmax(0, 1fr))'; // Still 7 columns for days of week

                // Render 7 days for the week
                for (let i = 0; i < 7; i++) {
                    const weekDate = new Date(date);
                    weekDate.setDate(date.getDate() + i);
                    const dateString = `${weekDate.getFullYear()}-${String(weekDate.getMonth() + 1).padStart(2, '0')}-${String(weekDate.getDate()).padStart(2, '0')}`;
                    const dayCell = createDayCell(dateString, weekDate.getMonth(), weekDate.getDate());
                    calendarGrid.appendChild(dayCell);
                }
            }
        }

        function createDayCell(dateString, month, day) {
            const dayCell = document.createElement('div');
            dayCell.classList.add('calendar-day-cell');
            dayCell.setAttribute('data-date', dateString); // Store date for drag and drop

            // Drag and drop event listeners for the day cell
            dayCell.addEventListener('dragover', (e) => {
                e.preventDefault(); // Allow drop
                dayCell.classList.add('drag-over');
            });
            dayCell.addEventListener('dragleave', () => {
                dayCell.classList.remove('drag-over');
            });
            dayCell.addEventListener('drop', (e) => {
                e.preventDefault();
                dayCell.classList.remove('drag-over');

                if (draggedTask && draggedFromDate) {
                    const targetDate = dayCell.getAttribute('data-date');
                    
                    // Update task in Firestore
                    updateTaskDateInFirestore(draggedTask.id, draggedFromDate, targetDate);

                    // Local UI update will happen via onSnapshot listener
                    draggedTask = null;
                    draggedFromDate = null;
                }
            });

            const dateDiv = document.createElement('div');
            dateDiv.classList.add('calendar-date');
            dateDiv.textContent = `${monthNames[month].substring(0, 3)} ${day}`; // e.g., Jul 4
            dayCell.appendChild(dateDiv);

            const dayTasks = tasks[dateString] || [];
            dayTasks.forEach(task => {
                const taskItem = document.createElement('div');
                taskItem.classList.add('task-item', `task-${task.difficulty}`);
                if (task.completed) {
                    taskItem.classList.add('completed');
                }
                taskItem.setAttribute('draggable', 'true'); // Make task draggable
                taskItem.setAttribute('data-task-id', task.id); // Store task ID
                taskItem.setAttribute('data-original-date', dateString); // Store original date for debugging/reference

                // Drag start event listener for the task item
                taskItem.addEventListener('dragstart', (e) => {
                    draggedTask = task;
                    draggedFromDate = dateString;
                    e.dataTransfer.setData('text/plain', task.id); // Set data for transfer
                    e.dataTransfer.effectAllowed = 'move';
                });

                const checkbox = document.createElement('input');
                checkbox.type = 'checkbox';
                checkbox.classList.add('form-checkbox', 'h-5', 'w-5', 'text-blue-600', 'bg-slate-700', 'border-slate-600', 'rounded', 'mr-2', 'cursor-pointer');
                checkbox.checked = task.completed;
                checkbox.addEventListener('change', function() {
                    // Update task completion in Firestore
                    updateTaskCompletionInFirestore(task.id, this.checked);
                    // Local UI update will happen via onSnapshot listener
                });

                const taskTextSpan = document.createElement('span');
                taskTextSpan.classList.add('task-text');
                taskTextSpan.textContent = task.text;

                taskItem.appendChild(checkbox);
                taskItem.appendChild(taskTextSpan);
                dayCell.appendChild(taskItem);
            });

            // Add notes if present in the original structure (simplified for dynamic tasks)
            if (dayTasks.length > 0 && dayTasks[0].difficulty !== 'rest') {
                const notesDiv = document.createElement('div');
                notesDiv.classList.add('notes-text');
                notesDiv.textContent = "Notes: Review concepts and apply strategies."; // Generic note
                dayCell.appendChild(notesDiv);
            } else if (dayTasks.length > 0 && dayTasks[0].difficulty === 'rest') {
                dayCell.classList.add('rest-day');
            }

            return dayCell;
        }

        function nextPeriod() {
            if (currentView === 'month') {
                currentMonth++;
                if (currentMonth > 11) {
                    currentMonth = 0;
                    currentYear++;
                }
            } else { // week view
                currentWeekStartDate.setDate(currentWeekStartDate.getDate() + 7);
                currentMonth = currentWeekStartDate.getMonth(); // Update month/year for display
                currentYear = currentWeekStartDate.getFullYear();
            }
            renderCalendar(currentMonth, currentYear, currentView);
        }

        function prevPeriod() {
            if (currentView === 'month') {
                currentMonth--;
                if (currentMonth < 0) {
                    currentMonth = 11;
                    currentYear--;
                }
            } else { // week view
                currentWeekStartDate.setDate(currentWeekStartDate.getDate() - 7);
                currentMonth = currentWeekStartDate.getMonth(); // Update month/year for display
                currentYear = currentWeekStartDate.getFullYear();
            }
            renderCalendar(currentMonth, currentYear, currentView);
        }

        function setView(view) {
            currentView = view;
            // When switching to week view, ensure currentWeekStartDate is set correctly for the current month
            if (currentView === 'week') {
                let today = new Date(currentYear, currentMonth, 1); // Start of the current month
                let dayOfWeek = today.getDay(); // 0 for Sunday, 1 for Monday
                let diff = today.getDate() - dayOfWeek + (dayOfWeek === 0 ? -6 : 1); // Adjust to Monday
                currentWeekStartDate = new Date(today.setDate(diff));
            } else { // Switching to month view, reset currentWeekStartDate to start of current month
                currentWeekStartDate = new Date(currentYear, currentMonth, 1);
            }
            renderCalendar(currentMonth, currentYear, currentView);
        }

        const wrapLabel = (label, maxLength = 16) => {
            if (typeof label !== 'string' || label.length <= maxLength) {
                return label;
            }
            const words = label.split(' ');
            const lines = [];
            let currentLine = '';
            for (const word of words) {
                if ((currentLine + ' ' + word).trim().length > maxLength) {
                    if (currentLine) lines.push(currentLine);
                    currentLine = word;
                } else {
                    currentLine = (currentLine + ' ' + word).trim();
                }
            }
            if (currentLine) lines.push(currentLine);
            return lines;
        };
        
        const tooltipTitleCallback = (tooltipItems) => {
            const item = tooltipItems[0];
            let label = item.chart.data.labels[item.dataIndex];
            if (Array.isArray(label)) {
              return label.join(' ');
            } else {
              return label;
            }
        };

        const chartColors = {
            blue: '#00A6FB',
            yellow: '#F5B700',
            magenta: '#DC0073',
            teal: '#00D2B8',
            slate: '#94a3b8'
        };

        const a2zData = {
            labels: ['Easy', 'Medium', 'Hard'],
            datasets: [{
                label: 'Problem Count',
                data: [131, 187, 136],
                backgroundColor: [chartColors.teal, chartColors.yellow, chartColors.magenta],
                borderColor: '#1f1f1f', /* Match new card background */
                borderWidth: 4,
                hoverOffset: 4
            }]
        };

        const a2zConfig = {
            type: 'doughnut',
            data: a2zData,
            options: {
                responsive: true,
                maintainAspectRatio: false,
                plugins: {
                    legend: {
                        position: 'top',
                        labels: {
                            color: chartColors.slate,
                            font: {
                                size: 14
                            }
                        }
                    },
                    tooltip: {
                        callbacks: {
                           title: tooltipTitleCallback
                        }
                    }
                },
                cutout: '60%',
            }
        };

        const dpData = {
            labels: ['Medium Problems', 'Hard Problems'].map(l => wrapLabel(l)),
            datasets: [{
                label: 'Problem Count in DP Series',
                data: [20, 36],
                backgroundColor: [chartColors.yellow, chartColors.magenta],
                borderColor: [chartColors.yellow, chartColors.magenta],
                borderWidth: 1,
                borderRadius: 5
            }]
        };

        const dpConfig = {
            type: 'bar',
            data: dpData,
            options: {
                indexAxis: 'y',
                responsive: true,
                maintainAspectRatio: false,
                scales: {
                    x: {
                        beginAtZero: true,
                        grid: {
                            color: '#3a3a3a' /* Darker grid lines */
                        },
                        ticks: {
                            color: chartColors.slate
                        }
                    },
                    y: {
                        grid: {
                            display: false
                        },
                        ticks: {
                            color: chartColors.slate,
                            font: {
                                size: 14
                            }
                        }
                    }
                },
                plugins: {
                    legend: {
                        display: false
                    },
                    tooltip: {
                        callbacks: {
                            title: tooltipTitleCallback
                        }
                    }
                }
            }
        };

        window.addEventListener('authReady', () => {
            console.log("Auth is ready. User ID:", window.userId);
            loadTasksFromFirestore();
        });

        window.onload = function() {
            const a2zCtx = document.getElementById('a2zDonutChart').getContext('2d');
            new Chart(a2zCtx, a2zConfig);

            const dpCtx = document.getElementById('dpBarChart').getContext('2d');
            new Chart(dpCtx, dpConfig);

            document.getElementById('prevBtn').addEventListener('click', prevPeriod);
            document.getElementById('nextBtn').addEventListener('click', nextPeriod);

            document.getElementById('monthViewBtn').addEventListener('click', () => setView('month'));
            document.getElementById('weekViewBtn').addEventListener('click', () => setView('week'));

            // Initialize currentWeekStartDate to the Monday of the current month's first week
            let initialDate = new Date(currentYear, currentMonth, 1);
            let dayOfWeek = initialDate.getDay(); // 0 for Sunday, 1 for Monday
            let diff = initialDate.getDate() - dayOfWeek + (dayOfWeek === 0 ? -6 : 1); // Adjust to Monday
            currentWeekStartDate = new Date(initialDate.setDate(diff));

            // Calendar rendering will be triggered by the Firestore onSnapshot listener after data loads
        };
    </script>
</body>
</html>
